(()=>{var Be=Object.create,X=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var we=t=>X(t,"__esModule",{value:!0});var L=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ce=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Te(e))!Le.call(t,n)&&n!=="default"&&X(t,n,{get:()=>e[n],enumerable:!(r=Ie(e,n))||r.enumerable});return t},_e=t=>Ce(we(X(t!=null?Be(Me(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Z=L(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.loop=x.conditional=x.parse=void 0;var De=function t(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(r))r.forEach(function(i){return t(e,i,n,s)});else if(typeof r=="function")r(e,n,s,t);else{var a=Object.keys(r)[0];Array.isArray(r[a])?(s[a]={},t(e,r[a],n,s[a])):s[a]=r[a](e,n,s,t)}return n};x.parse=De;var Ue=function(e,r){return function(n,s,a,i){r(n,s,a)&&i(n,e,s,a)}};x.conditional=Ue;var Re=function(e,r){return function(n,s,a,i){for(var o=[];r(n,s,a);){var d={};i(n,e,s,d),o.push(d)}return o}};x.loop=Re});var ee=L(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.readBits=f.readArray=f.readUnsigned=f.readString=f.peekBytes=f.readBytes=f.peekByte=f.readByte=f.buildStream=void 0;var ze=function(e){return{data:e,pos:0}};f.buildStream=ze;var ue=function(){return function(e){return e.data[e.pos++]}};f.readByte=ue;var $e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};f.peekByte=$e;var $=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};f.readBytes=$;var je=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};f.peekBytes=je;var Oe=function(e){return function(r){return Array.from($(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};f.readString=Oe;var Ne=function(e){return function(r){var n=$(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};f.readUnsigned=Ne;var We=function(e,r){return function(n,s,a){for(var i=typeof r=="function"?r(n,s,a):r,o=$(e),d=new Array(i),c=0;c<i;c++)d[c]=o(n);return d}};f.readArray=We;var Ge=function(e,r,n){for(var s=0,a=0;a<n;a++)s+=e[r+a]&&Math.pow(2,n-a-1);return s},Ke=function(e){return function(r){for(var n=ue()(r),s=new Array(8),a=0;a<8;a++)s[7-a]=!!(n&1<<a);return Object.keys(e).reduce(function(i,o){var d=e[o];return d.length?i[o]=Ge(s,d.index,d.length):i[o]=s[d.index],i},{})}};f.readBits=Ke});var de=L(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.default=void 0;var A=Z(),u=ee(),j={blocks:function(e){for(var r=0,n=[],s=e.data.length,a=0,i=(0,u.readByte)()(e);i!==r;i=(0,u.readByte)()(e)){if(e.pos+i>=s){var o=s-e.pos;n.push((0,u.readBytes)(o)(e)),a+=o;break}n.push((0,u.readBytes)(i)(e)),a+=i}for(var d=new Uint8Array(a),c=0,l=0;l<n.length;l++)d.set(n[l],c),c+=n[l].length;return d}},Ve=(0,A.conditional)({gce:[{codes:(0,u.readBytes)(2)},{byteSize:(0,u.readByte)()},{extras:(0,u.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,u.readUnsigned)(!0)},{transparentColorIndex:(0,u.readByte)()},{terminator:(0,u.readByte)()}]},function(t){var e=(0,u.peekBytes)(2)(t);return e[0]===33&&e[1]===249}),Qe=(0,A.conditional)({image:[{code:(0,u.readByte)()},{descriptor:[{left:(0,u.readUnsigned)(!0)},{top:(0,u.readUnsigned)(!0)},{width:(0,u.readUnsigned)(!0)},{height:(0,u.readUnsigned)(!0)},{lct:(0,u.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,A.conditional)({lct:(0,u.readArray)(3,function(t,e,r){return Math.pow(2,r.descriptor.lct.size+1)})},function(t,e,r){return r.descriptor.lct.exists}),{data:[{minCodeSize:(0,u.readByte)()},j]}]},function(t){return(0,u.peekByte)()(t)===44}),Xe=(0,A.conditional)({text:[{codes:(0,u.readBytes)(2)},{blockSize:(0,u.readByte)()},{preData:function(e,r,n){return(0,u.readBytes)(n.text.blockSize)(e)}},j]},function(t){var e=(0,u.peekBytes)(2)(t);return e[0]===33&&e[1]===1}),Ye=(0,A.conditional)({application:[{codes:(0,u.readBytes)(2)},{blockSize:(0,u.readByte)()},{id:function(e,r,n){return(0,u.readString)(n.blockSize)(e)}},j]},function(t){var e=(0,u.peekBytes)(2)(t);return e[0]===33&&e[1]===255}),Je=(0,A.conditional)({comment:[{codes:(0,u.readBytes)(2)},j]},function(t){var e=(0,u.peekBytes)(2)(t);return e[0]===33&&e[1]===254}),Ze=[{header:[{signature:(0,u.readString)(3)},{version:(0,u.readString)(3)}]},{lsd:[{width:(0,u.readUnsigned)(!0)},{height:(0,u.readUnsigned)(!0)},{gct:(0,u.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,u.readByte)()},{pixelAspectRatio:(0,u.readByte)()}]},(0,A.conditional)({gct:(0,u.readArray)(3,function(t,e){return Math.pow(2,e.lsd.gct.size+1)})},function(t,e){return e.lsd.gct.exists}),{frames:(0,A.loop)([Ve,Ye,Je,Qe,Xe],function(t){var e=(0,u.peekByte)()(t);return e===33||e===44})}],er=Ze;O.default=er});var ce=L(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.deinterlace=void 0;var rr=function(e,r){for(var n=new Array(e.length),s=e.length/r,a=function(S,v){var y=e.slice(v*r,(v+1)*r);n.splice.apply(n,[S*r,r].concat(y))},i=[0,4,2,1],o=[8,8,4,2],d=0,c=0;c<4;c++)for(var l=i[c];l<s;l+=o[c])a(l,d),d++;return n};N.deinterlace=rr});var le=L(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.lzw=void 0;var tr=function(e,r,n){var s=4096,a=-1,i=n,o,d,c,l,h,S,v,y,p,B,k,D,I,g,U,R,V=new Array(n),Q=new Array(s),H=new Array(s),q=new Array(s+1);for(D=e,d=1<<D,h=d+1,o=d+2,v=a,l=D+1,c=(1<<l)-1,p=0;p<d;p++)Q[p]=0,H[p]=p;var k,y,Se,I,g,R,U;for(k=y=Se=I=g=R=U=0,B=0;B<i;){if(g===0){if(y<l){k+=r[U]<<y,y+=8,U++;continue}if(p=k&c,k>>=l,y-=l,p>o||p==h)break;if(p==d){l=D+1,c=(1<<l)-1,o=d+2,v=a;continue}if(v==a){q[g++]=H[p],v=p,I=p;continue}for(S=p,p==o&&(q[g++]=I,p=v);p>d;)q[g++]=H[p],p=Q[p];I=H[p]&255,q[g++]=I,o<s&&(Q[o]=v,H[o]=I,o++,(o&c)==0&&o<s&&(l++,c+=o)),v=S}g--,V[R++]=q[g],B++}for(B=R;B<i;B++)V[B]=0;return V};W.lzw=tr});var me=L(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.decompressFrames=b.decompressFrame=b.parseGIF=void 0;var nr=ur(de()),ar=Z(),or=ee(),sr=ce(),ir=le();function ur(t){return t&&t.__esModule?t:{default:t}}var dr=function(e){var r=new Uint8Array(e);return(0,ar.parse)((0,or.buildStream)(r),nr.default)};b.parseGIF=dr;var cr=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),s=0;s<r;s++){var a=s*4,i=e.pixels[s],o=e.colorTable[i]||[0,0,0];n[a]=o[0],n[a+1]=o[1],n[a+2]=o[2],n[a+3]=i!==e.transparentIndex?255:0}return n},pe=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var s=e.image,a=s.descriptor.width*s.descriptor.height,i=(0,ir.lzw)(s.data.minCodeSize,s.data.blocks,a);s.descriptor.lct.interlaced&&(i=(0,sr.deinterlace)(i,s.descriptor.width));var o={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return s.descriptor.lct&&s.descriptor.lct.exists?o.colorTable=s.lct:o.colorTable=r,e.gce&&(o.delay=(e.gce.delay||10)*10,o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),n&&(o.patch=cr(o)),o};b.decompressFrame=pe;var lr=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return pe(n,e.gct,r)})};b.decompressFrames=lr});var ke=t=>new Promise((e,r)=>{let n=new FileReader;n.addEventListener("load",s=>{let a=s?.target?.result;if(!a){r(new TypeError("readImage: No file."));return}e(a)}),n.readAsDataURL(t)});var oe=ke;var Y={},m=[],He=()=>{m.push([0,0,0,0]),m.push([128,0,0,1]),m.push([0,128,0,2]),m.push([128,128,0,3]),m.push([0,0,128,4]),m.push([128,0,128,5]),m.push([0,128,128,6]),m.push([192,192,192,7]),m.push([128,128,128,8]),m.push([255,0,0,9]),m.push([0,255,0,10]),m.push([255,255,0,11]),m.push([0,0,255,12]),m.push([255,0,255,13]),m.push([0,255,255,14]),m.push([255,255,255,15]),[0,95,135,175,215,255].forEach(t=>{[0,95,135,175,215,255].forEach(e=>{[0,95,135,175,215,255].forEach(r=>{m.push([t,e,r,16+parseInt(""+Math.floor(t/255*5)+Math.floor(e/255*5)+Math.floor(r/255*5),6)])})})}),[8,18,28,38,48,58,68,78,88,98,108,118,128,138,148,158,168,178,188,198,208,218,228,238].forEach(t=>{m.push([t,t,t,232+Math.floor(t/10)])})},qe=(t,e)=>[...t].sort((r,n)=>Math.abs(r[0]-e[0])+Math.abs(r[1]-e[1])+Math.abs(r[2]-e[2])-(Math.abs(n[0]-e[0])+Math.abs(n[1]-e[1])+Math.abs(n[2]-e[2]))||r[3]-n[3]).shift()||[0,0,0,0],Pe=(t,e,r)=>{m.length||He();let n=[t,e,r].toString();return Y[n]?Y[n]:Y[n]=(qe(m,[t,e,r])||[])[3]},z=Pe;var J=document.createElement("canvas"),se=J.getContext("2d"),Fe=(t,e)=>{let r=t.width,n=t.height;if(r>e.maxWidth){let l=r/e.maxWidth;r=e.maxWidth,n=Math.floor(n/l)}if(n>e.maxHeight){let l=n/e.maxHeight;n=e.maxHeight,r=Math.floor(r/l)}J.width=r,J.height=n,se.drawImage(t,0,0,r,n);let s=se.getImageData(0,0,r,n),a=s.data,i="";for(var o=0,d=a.length,c=0;o<d;)if(e.colours==="true")e.unicode?(a[o]===a[o+r*4]&&a[o+1]===a[o+1+r*4]&&a[o+2]===a[o+2+r*4]?i+="\\e[48;2;"+a[o]+";"+a[o+1]+";"+a[o+2]+"m ":n-c==1?i+="\\e[0m\\e[48;2;"+a[o]+";"+a[o+1]+";"+a[o+2]+"m ":i+="\\e[48;2;"+a[o]+";"+a[o+1]+";"+a[o+2]+"m\\e[38;2;"+a[o+r*4]+";"+a[o+1+r*4]+";"+a[o+2+r*4]+"m\u2584",o+=4,o&&!(o/4%r)&&(i+=`\\e[0m
`,o+=4*r,c+=2)):(i+="\\e[48;2;"+a[o]+";"+a[o+1]+";"+a[o+2]+"m  ",o+=4,c++,o&&!(o/4%r)&&(i+=`\\e[0m
`));else if(e.unicode){let l=z(a[o],a[o+1],a[o+2]),h=z(a[o+r*4],a[o+1+r*4],a[o+2+r*4]);l===h?i+="\\e[48;5;"+l+"m ":n-c==1?i+="\\e[0m\\e[48;5;"+l+"m ":i+="\\e[48;5;"+l+"m\\e[38;5;"+h+"m\u2584",o+=4,o&&!(o/4%r)&&(i+=`\\e[0m
`,o+=4*r,c+=2)}else i+="\\e[48;5;"+z(a[o],a[o+1],a[o+2])+"m  ",o+=4,c++,o&&!(o/4%r)&&(i+=`\\e[0m
`);for(;i.match(/(\\e\[[\d;]+m)([▄ ]+)\1/g);)i=i.replace(/(\\e\[[\d;]+m)([▄ ]+)\1/g,"$1$2");return i},ie=Fe;var G=_e(me());var pr=t=>t.split(/\s*,\s*/).reduce((e,r)=>{if(r.match(/-/)){let[n,s]=r.split(/\s*-\s*/).map(a=>parseInt(a,10));[...new Array(s-n+1).keys()].forEach(a=>e.push(n+a))}else r.match(/^\d+$/)&&e.push(parseInt(r,10));return e},[]),fe=pr;document.addEventListener("click",t=>{let e=t.target;if(!(e instanceof HTMLElement)||!e.matches("a.copy"))return;t.preventDefault();let r=e.dataset.clipboardTarget??null;if(!r)return;let n=document.querySelector(r);!n||navigator.clipboard.writeText(n.innerText)});var T=document.querySelector(".parser .btn"),K=T.querySelector('input[type="file"]'),w=document.querySelector(".url-container"),E=document.querySelector('input[type="url"]'),re=document.querySelector(".error-container"),ve=re.querySelector(".error-content"),C=document.querySelector(".options"),ge=Array.from(document.querySelectorAll('input[name="colours"]')),he=document.querySelector('input[name="maxHeight"]'),ye=document.querySelector('input[name="maxWidth"]'),xe=document.querySelector('input[name="unicode"]'),Ae=Array.from(document.querySelectorAll('input[name="loop"]')),[P]=Ae,F=document.querySelector('input[name="loop_n"]'),be=document.querySelector(".plural"),M=document.querySelector('input[name="frames"]'),mr=document.querySelector("pre.terminal"),fr=document.querySelector("pre.copy-paste code"),te=(t="")=>{if(t===""){re.classList.add("d-none"),ve.innerText="";return}re.classList.remove("d-none"),ve.innerText=t},_=document.createElement("canvas"),ne=_.getContext("2d"),Ee=(t,e=()=>{})=>fetch(t).then(r=>r.arrayBuffer()).then(r=>(0,G.parseGIF)(r)).then(r=>(_.height=r.lsd.height,_.width=r.lsd.width,(0,G.decompressFrames)(r,!0))).then(r=>{M.value===""&&(M.value=`1-${r.length}`),ne.imageSmoothingEnabled=!1;let n=fe(M.value),s=r.map((a,i)=>{if(!n.includes(i+1))return{ansiEscape:"",delay:0};let o=document.createElement("canvas"),d=o.getContext("2d");o.height=a.dims.height,o.width=a.dims.width;let c=d.createImageData(a.dims.width,a.dims.height);return c.data.set(a.patch),d.putImageData(c,a.dims.left,a.dims.top),a.disposalType===2&&ne.clearRect(0,0,_.width,_.height),ne.drawImage(o,0,0),{ansiEscape:ie(_,{colours:ge.reduce((h,S)=>S.checked?S.value:h,"256"),maxHeight:parseInt(he.value,10),maxWidth:parseInt(ye.value,10),unicode:xe.checked}),delay:a.delay}});fr.innerText=`${s.reduce((a,i,o)=>(n.includes(o+1)&&a.push(`frame${o+1}() {
printf "${i.ansiEscape}";
}`),a),[]).join(`
`)}

${P.checked?`i=${F.value};
`:""}while ${P.checked?"((i--))":"true"}; do
${n.map(a=>`frame${a};
sleep ${s[a-1].delay/1e3};
printf '\\e[${s[a-1].ansiEscape.match(/\n/g).length}A';`).join(`

`)}
done
`,mr.innerText=s[n[0]-1].ansiEscape,te("")}).catch(r=>{te(r.message)}).finally(e),ae=(t=()=>{})=>{let e=K?.files?.[0],r=E.value;if(e){oe(e).then(n=>Ee(n,t)).catch(n=>te(n.message));return}r&&Ee(r,t),t()};K.addEventListener("input",()=>{M.value="",E.value=""});E.addEventListener("input",t=>{if(!E.reportValidity()||E.value===""){t.stopImmediatePropagation();return}M.value="",K.value=""});P.addEventListener("focus",()=>F.focus());F.addEventListener("input",()=>{if(parseInt(F.value,10)===1){be.classList.add("d-none");return}be.classList.remove("d-none"),P.checked||(P.checked=!0)});M.addEventListener("change",()=>{requestAnimationFrame(()=>[T,w,C].forEach(t=>t.classList.add("loading"))),ae(()=>[T,w,C].forEach(t=>t.classList.remove("loading")))});M.addEventListener("keydown",({key:t})=>{t==="Enter"&&(requestAnimationFrame(()=>[T,w,C].forEach(e=>e.classList.add("loading"))),ae(()=>[T,w,C].forEach(e=>e.classList.remove("loading"))))});[K,E,xe,...ge,ye,he,...Ae,F].forEach(t=>t.addEventListener("input",({target:e})=>{requestAnimationFrame(()=>[T,w,C].forEach(r=>r.classList.add("loading"))),ae(()=>{[T,w,C].forEach(r=>r.classList.remove("loading")),e===E&&E.focus()})}));})();
//# sourceMappingURL=app.js.map
